"use strict";(self["webpackChunkdemo001"]=self["webpackChunkdemo001"]||[]).push([[718],{52718:function(t,e,i){i.r(e),i.d(e,{default:function(){return J}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dicMaintenance-page"},[e("div",{staticClass:"page-together"},[e("div",{staticClass:"page-left"},[e("select-node",{on:{"print-busi-id":t.handlePrintBusiId,"print-busi":t.handlePrintBusi}})],1),e("div",{staticClass:"page-right"},[e("script-node",{ref:"scriptNode",attrs:{"busi-id":t.receivedBusiId,busi:t.receivedBusi},on:{selectedRowKeysChange:t.selectedRowKeysChange}}),e("intention-node",{attrs:{selectedRowKeys:t.selectedRowKeys,selectedRows:t.selectedRows,"busi-id":t.receivedBusiId,busi:t.receivedBusi},on:{goodComplete:t.goodComplete,badComplete:t.badComplete}})],1)])])},n=[],o=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"node"},[t._m(0),e("div",{staticClass:"btn"},[e("a-button",{staticClass:"addButton",attrs:{type:"primary"},on:{click:t.addNode}},[t._v("新建")]),e("a-button",{staticClass:"deleteButton",attrs:{type:"primary",disabled:0===t.selectedRowKeys.length},on:{click:t.batchDelete}},[t._v("批量删除")])],1),e("a-table",{staticClass:"script-table",attrs:{rowKey:"uuid",columns:t.columns,"data-source":t.listData,"row-selection":t.rowSelection,scroll:{y:300},pagination:!1},on:{change:t.handleTableChange},scopedSlots:t._u([{key:"index",fn:function(e,i,s){return[t._v(" "+t._s(s+1)+" ")]}},{key:"ellipsis-with-tooltip",fn:function(i){return[i&&i.length>=2?e("ATooltip",{staticClass:"script-table-tooltip",attrs:{placement:"topLeft",title:i}},[t._v(t._s(i))]):[t._v(t._s(i))]]}},t._l(t.slotList,(function(i){return{key:i.name,fn:function(s,n){return[!0===n.edit?e("a-input",{key:i.key,model:{value:n[i.key],callback:function(e){t.$set(n,i.key,e)},expression:"record[col.key]"}}):s&&s.length>=2?e("ATooltip",{key:i.key,staticClass:"script-table-tooltip",attrs:{placement:"topLeft",title:s}},[t._v(t._s(s))]):e("div",{key:i.key},[t._v(t._s(s))])]}}})),{key:"operation",fn:function(i,s){return e("span",{},[s.edit?t._e():e("a-button",{attrs:{type:"link"},on:{click:function(e){return t.edit(s)}}},[t._v("编辑")]),s.edit?e("a-button",{attrs:{type:"link"},on:{click:function(e){return t.save(s)}}},[t._v("保存")]):t._e(),e("a-button",{attrs:{type:"link"},on:{click:function(e){t.handleDelete(s)}}},[t._v("删除")])],1)}}],null,!0)})],1)])},d=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"node-up"},[e("label",[t._v("话术节点")])])}],l=(i(44114),i(31552)),a=i(17313);const c=(t={})=>(0,a.li)("post","dic-busi/getBusiByGroup",{},t),r=(t={})=>(0,a.li)("post","dic-busi/addBusi",{},t),u=(t={})=>(0,a.li)("post","dic-busi/delBusi",{},t),p=(t={})=>(0,a.li)("post","dic-busi/updateBusi",{},t),h=(t={})=>(0,a.li)("post","/dic-script-node/updateScriptNodeById",{},t),y=(t={})=>(0,a.li)("post","/dic-script-node/delScriptNodeByIds",{},t),b=(t={})=>(0,a.li)("post","/dic-intention/updateIntentionById",{},t),m=(t={})=>(0,a.li)("post","/dic-intention/delIntentionByIds",{},t),k=(t={})=>(0,a.li)("post","/dic-script-node/addScriptNode",{},t),f=(t={})=>(0,a.li)("post","/dic-intention/addIntention",{},t);var v=i(17670);const I=[{title:"序号",scopedSlots:{customRender:"index"},width:"100px"},{title:"业务",dataIndex:"busi",key:"busi",ellipsis:!0,scopedSlots:{customRender:"ellipsis-with-tooltip"}},{title:"话术节点",dataIndex:"scriptNode",key:"scriptNode",ellipsis:!0,scopedSlots:{customRender:"scriptNode-input"}},{title:"操作",key:"operation",dataIndex:"operation",scopedSlots:{customRender:"operation"},width:"200px"}],w=[{name:"scriptNode-input",key:"scriptNode"}];var g={props:["busiId","busi"],name:"scriptNode",components:{},data(){return{businessList:[],listData:[],columns:I,total:0,slotList:w,query:{busi:this.busi,busiId:this.busiId,intentionId:"",scriptNodeId:""},selectedRowKeys:[],selectedRows:[]}},watch:{busiId:function(){this.getList()}},mounted(){this.getList()},computed:{rowSelection(){return{onChange:t=>{this.selectedRowKeys=t,this.selectedRows=this.selectedRows.filter((t=>this.selectedRowKeys.includes(t.ScriptNodeId))),this.selectedRowKeys.forEach((t=>{-1===this.selectedRows.findIndex((e=>e.ScriptNodeId===t))&&this.selectedRows.push(this.listData.find((e=>e.ScriptNodeId===t)))})),this.$emit("selectedRowKeysChange",this.selectedRowKeys,this.selectedRows)},selectedRowKeys:this.selectedRowKeys}}},methods:{handleTableChange(t){this.pageNum=t.current,this.pageSize=t.pageSize},getList(){(0,l.Cm)({busiId:this.busiId,scriptNodeId:this.query.scriptNodeId?this.query.scriptNodeId:void 0}).then((t=>{this.listData=t?.data||[],this.total=t?.data?.pageTotal||0}),(t=>{(0,v.b4)(t,"获取数据失败")}))},edit(t){this.$set(t,"edit",!0)},save(t){t.scriptNodeId?h({id:t.scriptNodeId,scriptNode:t.scriptNode}).then((()=>{t.edit=!1,this.$emit("save"),(0,v.kP)("保存成功")}),(t=>{(0,v.b4)(t,"保存失败")})):k({busiId:t.busiId,scriptNode:t.scriptNode}).then((()=>{t.edit=!1,this.$emit("save"),(0,v.kP)("保存成功")}),(t=>{(0,v.b4)(t,"保存失败")}))},handleDelete(t){this.deleteManyScriptApi(t.scriptNodeId)},batchDelete(){0!==this.selectedRowKeys.length?this.deleteManyScriptApi(this.selectedRowKeys.join(",")):(0,v.b4)(null,"请至少选择一条数据")},deleteManyScriptApi(t){this.$confirm({title:"删除后不可恢复，确认删除？",onOk:()=>{y({ids:t}).then((()=>{(0,v.kP)("删除成功"),this.getList()}),(t=>{(0,v.b4)(t,"删除失败")}))}})},addNode(){const t={uuid:Date.now(),busiId:this.busiId,busi:this.busi,scriptNode:"",edit:!0};this.listData.push(t)}}},_=g,R=i(81656),C=(0,R.A)(_,o,d,!1,null,"35f2fe9d",null),K=C.exports,N=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"inten"},[t._m(0),e("div",{staticClass:"btn"},[e("a-button",{staticClass:"addButton",attrs:{type:"primary"},on:{click:t.addNode}},[t._v("新建")]),e("a-button",{staticClass:"deleteButton",attrs:{type:"primary",disabled:0===t.selectedRowKeys.length},on:{click:t.batchDelete}},[t._v("批量删除")])],1),e("a-table",{staticClass:"intention-table",attrs:{rowKey:"uuid",columns:t.columns,"data-source":t.listData,"row-selection":t.rowSelection,scroll:{y:450},pagination:!1},on:{change:t.handleTableChange},scopedSlots:t._u([{key:"index",fn:function(e,i,s){return[t._v(" "+t._s(s+1)+" ")]}},{key:"ellipsis-with-tooltip",fn:function(i){return[i&&i.length>=2?e("ATooltip",{staticClass:"custom-table-tooltip",attrs:{placement:"topLeft",title:i}},[t._v(t._s(i))]):[t._v(t._s(i))]]}},t._l(t.slotList,(function(i){return{key:i.name,fn:function(s,n){return[!0===n.edit?e("a-input",{key:i.key,model:{value:n[i.key],callback:function(e){t.$set(n,i.key,e)},expression:"record[col.key]"}}):s&&s.length>=2?e("ATooltip",{key:i.key,staticClass:"custom-table-tooltip",attrs:{placement:"topLeft",title:s}},[t._v(t._s(s))]):e("div",{key:i.key},[t._v(t._s(s))])]}}})),{key:"operation",fn:function(i,s){return e("span",{},[s.edit?t._e():e("a-button",{attrs:{type:"link"},on:{click:function(e){return t.edit(s)}}},[t._v("编辑")]),s.edit?e("a-button",{attrs:{type:"link"},on:{click:function(e){return t.save(s)}}},[t._v("保存")]):t._e(),e("a-button",{attrs:{type:"link"},on:{click:function(e){t.handleDelete(s)}}},[t._v("删除")])],1)}}],null,!0)})],1)])},S=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"inten-down"},[e("label",[t._v("意图节点")])])}];const x=[{title:"序号",scopedSlots:{customRender:"index"},width:"100px"},{title:"业务",dataIndex:"busi",key:"busi",ellipsis:!0,scopedSlots:{customRender:"ellipsis-with-tooltip"}},{title:"意图节点",key:"intention",dataIndex:"intention",ellipsis:!0,scopedSlots:{customRender:"intention-input"}},{title:"操作",key:"operation",dataIndex:"operation",scopedSlots:{customRender:"operation"},width:"200px"}],B=[{name:"intention-input",key:"intention"}];var D={props:["busiId","busi"],name:"intentionNode",components:{},data(){return{businessList:[],listData:[],columns:x,total:0,slotList:B,intentionList:[],query:{busi:this.busi,busiId:this.busiId,intentionId:""},selectedRowKeys:[],selectedRows:[]}},watch:{busiId:function(){this.getList()}},mounted(){this.getList()},computed:{rowSelection(){return{onChange:t=>{this.selectedRowKeys=t,this.selectedRows=this.selectedRows.filter((t=>this.selectedRowKeys.includes(t.libUnionScriptId))),this.selectedRowKeys.forEach((t=>{-1===this.selectedRows.findIndex((e=>e.libUnionScriptId===t))&&this.selectedRows.push(this.listData.find((e=>e.libUnionScriptId===t)))})),this.$emit("selectedRowKeysChange",this.selectedRowKeys,this.selectedRows)},selectedRowKeys:this.selectedRowKeys}}},methods:{handleTableChange(t){this.pageNum=t.current,this.pageSize=t.pageSize},getList(){(0,l.Vg)({busiId:this.busiId,intentionId:this.query.intentionId?this.query.intentionId:void 0}).then((t=>{this.listData=t?.data||[],this.total=t?.data?.pageTotal||0}),(t=>{(0,v.b4)(t,"获取数据失败")}))},edit(t){this.$set(t,"edit",!0)},save(t){t.intentionId?b({id:t.intentionId,intention:t.intention}).then((()=>{t.edit=!1,this.$emit("save"),(0,v.kP)("保存成功")}),(t=>{(0,v.b4)(t,"保存失败")})):f({busiId:t.busiId,intention:t.intention}).then((()=>{t.edit=!1,this.$emit("save"),(0,v.kP)("保存成功")}),(t=>{(0,v.b4)(t,"保存失败")}))},handleDelete(t){this.deleteManyIntentionApi(t.intentionId)},batchDelete(){0!==this.selectedRowKeys.length?this.deleteManyIntentionApi(this.selectedRowKeys.join(",")):(0,v.b4)(null,"请至少选择一条数据")},deleteManyIntentionApi(t){this.$confirm({title:"删除后不可恢复，确认删除？",onOk:()=>{m({ids:t}).then((()=>{(0,v.kP)("删除成功"),this.getList()}),(t=>{(0,v.b4)(t,"删除失败")}))}})},addNode(){const t={uuid:Date.now(),busiId:this.busiId,busi:this.busi,intention:"",edit:!0};this.listData.push(t)}}},L=D,A=(0,R.A)(L,N,S,!1,null,"4d75b52c",null),$=A.exports,P=function(){var t=this,e=t._self._c;return e("div",{staticClass:"treeSelect"},[t._m(0),e("br"),e("br"),e("br"),e("a-tree",{attrs:{"expanded-keys":t.expandedKeys,"auto-expand-parent":t.autoExpandParent,"selected-keys":t.selectedKeys,"tree-data":t.treeData,"show-icon":""},on:{expand:t.onExpand,select:t.onSelect},scopedSlots:t._u([{key:"handleFather",fn:function(i){return[e("div",{staticClass:"node-container"},[e("span",{staticClass:"title"},[t._v(t._s(i.title))]),e("a-dropdown",{attrs:{trigger:["click"]}},[e("a",{staticClass:"addLink"},[e("a-icon",{attrs:{slot:"icon-more",type:"more"},slot:"icon-more"})],1),e("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[e("a-menu-item",[e("a",{on:{click:function(e){return t.handleNewItem(i)}}},[t._v("新建")])])],1)],1)],1)]}},{key:"handleSon",fn:function(i){return[e("div",{staticClass:"node-container",on:{click:function(e){return t.printBusiId(i)}}},[e("span",{staticClass:"title",on:{dblclick:function(e){return t.handleEdit(i)}}},[t._v(t._s(i.title))]),e("a-dropdown",{attrs:{trigger:["click"]}},[e("a",{staticClass:"addLink"},[e("a-icon",{attrs:{slot:"icon-more",type:"more"},slot:"icon-more"})],1),e("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[e("a-menu-item",[e("a",{on:{click:function(e){return t.handleEdit(i)}}},[t._v("编辑")])]),e("a-menu-item",[e("a",{on:{click:function(e){return t.handleDelete(i)}}},[t._v("删除")])])],1)],1)],1)]}}])})],1)},E=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"label"},[e("label",[t._v("业务字典")])])}];const T=[];var q={data(){return{expandedKeys:["卡办理","金融理财"],autoExpandParent:!0,selectedKeys:[],treeData:T,editingKey:null,query:{busiId:"",busi:""}}},mounted(){this.getList()},methods:{getList(){c({busiId:this.query.busiId,busi:this.query.busi}).then((t=>{const e=t?.data||[];e.forEach((t=>{t.edit=!1})),this.treeData=this.transformData(e)}),(t=>{(0,v.b4)(t,"获取数据失败")}))},transformData(t){return t.map((t=>({title:t.busi,key:t.busiId,scopedSlots:{title:"handleFather"},children:t.childBusi&&t.childBusi.map((t=>({title:t.busi,key:t.busiId,scopedSlots:{title:"handleSon"}})))})))},handleNewItem(t){const e=prompt("请输入新的业务名称","");null!==e&&""!==e&&this.addNode(t,e)},addNode(t,e){const i=t.key;r({busi:e,pid:i}).then((i=>{const s={title:e,key:i.data.busiId,scopedSlots:{title:"handleSon"}};t.children?t.children.push(s):t.children=[s],this.treeData=JSON.parse(JSON.stringify(this.treeData))}),(t=>{(0,v.b4)(t,"创建新节点失败")}))},onExpand(t){console.log("onExpand",t),this.expandedKeys=t,this.autoExpandParent=!1},handleEdit(t){this.editingKey=t.key;const e=prompt("请输入新的业务名称",t.title);null!==e&&""!==e?p({busiId:t.key,busi:e}).then((e=>{t.key=e.data.busiId,t.title=e.data.busi,this.editingKey=null,(0,v.kP)("编辑成功")})).catch((t=>{(0,v.b4)(t,"编辑失败")})):this.editingKey=null},handleDelete(t){this.delBusiApi(t.key)},batchDelete(){0!==this.selectedRowKeys.length?this.delBusiApi(this.selectedRowKeys.join(",")):(0,v.b4)(null,"请至少选择一条数据")},delBusiApi(t){this.$confirm({title:"删除后不可恢复，确认删除？",onOk:()=>{u({busiId:t}).then((()=>{(0,v.kP)("删除成功"),this.getList()}),(t=>{(0,v.b4)(t,"删除失败")}))}})},onSelect(t,e){console.log("onSelect",e),this.selectedKeys=t},printBusiId(t){console.log(t.key,t.title),this.$emit("print-busi-id",t.key),this.$emit("print-busi",t.title)}}},M=q,O=(0,R.A)(M,P,E,!1,null,"7f670244",null),z=O.exports,j={name:"dicMaintenance",components:{scriptNode:K,IntentionNode:$,selectNode:z},data(){return{selectedRowKeys:[],selectedRows:[],receivedBusiId:null,receivedBusi:null}},methods:{handlePrintBusiId(t){this.receivedBusiId=t,console.log(t)},handlePrintBusi(t){this.receivedBusi=t,console.log(t)},selectedRowKeysChange(t,e){this.selectedRowKeys=t,this.selectedRows=e},goodComplete(){this.$refs.scriptNode.getList()},badComplete(){this.$refs.IntentionNode.getList()}}},U=j,F=(0,R.A)(U,s,n,!1,null,"18dc12f6",null),J=F.exports}}]);